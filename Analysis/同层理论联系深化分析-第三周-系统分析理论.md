# 同层理论联系深化分析 - 第三周：系统分析理论

## 一、目标

- 系统化覆盖 Petri 网与分布式系统的核心分析：可达性、死锁、有界性、活性、公平性。
- 引入性能与稳定性分析：时延、吞吐、稳态/暂态、Lyapunov 稳定、MPC 可行性。
- 建立一致性分析桥梁：将 Paxos/Raft 等一致性协议以网/时序模型刻画并验证。

---

## 二、状态空间与可达性

### 2.1 可达图/覆盖图

- 可达图：节点为标识/系统状态，边为事件/变迁发生
- 覆盖图（Karp-Miller）：以 ω 标记无界增长

```rust
// 覆盖图构造（简化伪代码）
fn build_coverability_graph(net: &PetriNet) -> CoverGraph { /* ... */ }
```

### 2.2 状态空间缩减

- 部分序约简（POR）：独立变迁交换不影响性质
- 展开（unfolding）：构造无环因果网以避免组合爆炸

---

## 三、核心判定问题

### 3.1 死锁/活性

- 死锁：无可使能变迁的标识；性质：G F enabled 违例
- 活性：每个变迁可无限次使能（或满足弱活性）

### 3.2 有界性/保守性

- 有界：∀p, ∃k, ∀可达 M, M(p) ≤ k
- 保守：存在正向量 w，使得 w·M 常数

```rust
// 线性不变量求解（LP/ILP）
fn compute_place_invariants(net: &PetriNet) -> Vec<Vector> { /* ... */ }
```

### 3.3 公平性

- 弱公平/强公平在时序逻辑中刻画（GF/FG 模式）

---

## 四、性能与稳定性

### 4.1 时延与吞吐

- 定时网（TPN）：弧/变迁携带时间窗
- 吞吐分析：最大流/瓶颈变迁识别、Little 定律近似

### 4.2 控制稳定性

- Lyapunov 函数 V(x)：ΔV(x) < 0 ⇒ 渐近稳定
- MPC 可行域：滚动优化保持约束满足与稳定

```rust
// Lyapunov 条件检查（伪代码）
fn check_lyapunov(A: &Mat, P: &Mat) -> bool { /* A'PA - P < 0 */ }
```

---

## 五、一致性协议分析

### 5.1 协议建模

- 将 Paxos/Raft 角色映射为进程与通道；关键阶段为变迁
- 不变量：单值决定性、日志前缀、选主唯一

### 5.2 规范与验证

- 安全：G ¬twoLeaders ∧ G (agreed ⇒ sameValue)
- 活性：G F commit

```rust
// 协议反例最小化
fn minimize_counterexample(trace: &Trace) -> Trace { /* ... */ }
```

---

## 六、工具化与报告

- 报告维度：性质是否满足、反例路径、最小冲突割集、性能瓶颈
- 可视化：可达图/展开网、关键库所热度、时序沿革

---

## 七、结论与下一步

- 已形成系统分析的方法族：从结构不变量到时序性质与性能/稳定性。
- 下一步进入“系统应用协同”：在并发建模、死锁检测、性能优化、实时与CPS中的落地策略。
